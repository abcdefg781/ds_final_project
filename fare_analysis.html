<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Fare analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="united.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="overview.html">Project Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Graphs and Charts
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="heatmaps.html">Heatmaps</a>
    </li>
    <li>
      <a href="timedist.html">Time Distributions</a>
    </li>
    <li>
      <a href="congestion.html">Congestion</a>
    </li>
  </ul>
</li>
<li>
  <a href="dashboard.html">Taxi Zone Map</a>
</li>
<li>
  <a href="https://ngduong.shinyapps.io/doexplore/?fbclid=IwAR05Ib9AFD60fWIZ9bHZNYzezL7hoAzzre_chAOZ60Ig7TlzBTJCmEC3_wQ">Interactive Maps</a>
</li>
<li>
  <a href="https://ngduong.shinyapps.io/fareest/">Fare Predictor</a>
</li>
<li>
  <a href="https://github.com/abcdefg781/ds_final_project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Fare analysis</h1>

</div>


<p>Here, we want to look at what variables are significant predictors for fare, with the final goal of building a taxi fare estimator that can take values on key variables and produce an estimated fare.</p>
<p>First, we do some exploratory analysis to provide an brief overview about the variable fare, and how it is distributed across boroughs, neighborhoods, type of taxis, and time of day.</p>
<pre class="r"><code>#Total taxi fares by the hour
ggplotly(transport_final %&gt;% 
  filter(pickup_date == &quot;2019-02-14&quot;,
         type != &quot;for hire&quot;,
         pu_boro != &quot;Staten Island&quot;) %&gt;% 
  group_by(pickup_hr, pu_boro, type) %&gt;%  
  drop_na(pu_boro) %&gt;% 
  summarize(total_fare = sum(fare_amount)) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(x = pickup_hr, y = total_fare, color = type)) +
  geom_path() +
  facet_grid(pu_boro~.) + 
  scale_x_continuous(
    breaks = seq(0, 23, by = 1)) +
  labs(title = &quot;Hourly total fares spent on drop-off locations in Manhattan&quot;,
    x = &quot;Pick-up hour&quot;,
    y = &quot;Total fare ($)&quot;) +
  theme_bw() + 
  theme(        
    plot.title =        
          element_text(hjust = 0.5, size=12, face=&#39;bold&#39;),
    plot.subtitle = 
          element_text(hjust = 0.5),
    legend.title =
          element_blank()) +
    viridis::scale_color_viridis(discrete = TRUE))</code></pre>
<p><div id="htmlwidget-7857d0fe9fd1ac65d06e" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7857d0fe9fd1ac65d06e">{"x":{"data":[{"x":[0,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22],"y":[14,47.89,129.77,257.2,363.44,289.12,194.63,196.33,102.5,114.93,118.5,128.31,56.5,115.57,22.47,67.35,45.5,120.5],"text":["pickup_hr:  0<br />total_fare:    14.00<br />type: green","pickup_hr:  4<br />total_fare:    47.89<br />type: green","pickup_hr:  6<br />total_fare:   129.77<br />type: green","pickup_hr:  7<br />total_fare:   257.20<br />type: green","pickup_hr:  8<br />total_fare:   363.44<br />type: green","pickup_hr:  9<br />total_fare:   289.12<br />type: green","pickup_hr: 10<br />total_fare:   194.63<br />type: green","pickup_hr: 11<br />total_fare:   196.33<br />type: green","pickup_hr: 12<br />total_fare:   102.50<br />type: green","pickup_hr: 13<br />total_fare:   114.93<br />type: green","pickup_hr: 14<br />total_fare:   118.50<br />type: green","pickup_hr: 15<br />total_fare:   128.31<br />type: green","pickup_hr: 16<br />total_fare:    56.50<br />type: green","pickup_hr: 17<br />total_fare:   115.57<br />type: green","pickup_hr: 18<br />total_fare:    22.47<br />type: green","pickup_hr: 19<br />total_fare:    67.35<br />type: green","pickup_hr: 20<br />total_fare:    45.50<br />type: green","pickup_hr: 22<br />total_fare:   120.50<br />type: green"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(68,1,84,1)","dash":"solid"},"hoveron":"points","name":"green","legendgroup":"green","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[41.5,37,19,51.59,17,255.93,483.36,516.67,421,264.17,277.08,323.69,387.26,193.36,200,193.41,323.73,231.13,122.5,204.5,276.47,103,173.14],"text":["pickup_hr:  0<br />total_fare:    41.50<br />type: green","pickup_hr:  1<br />total_fare:    37.00<br />type: green","pickup_hr:  2<br />total_fare:    19.00<br />type: green","pickup_hr:  4<br />total_fare:    51.59<br />type: green","pickup_hr:  5<br />total_fare:    17.00<br />type: green","pickup_hr:  6<br />total_fare:   255.93<br />type: green","pickup_hr:  7<br />total_fare:   483.36<br />type: green","pickup_hr:  8<br />total_fare:   516.67<br />type: green","pickup_hr:  9<br />total_fare:   421.00<br />type: green","pickup_hr: 10<br />total_fare:   264.17<br />type: green","pickup_hr: 11<br />total_fare:   277.08<br />type: green","pickup_hr: 12<br />total_fare:   323.69<br />type: green","pickup_hr: 13<br />total_fare:   387.26<br />type: green","pickup_hr: 14<br />total_fare:   193.36<br />type: green","pickup_hr: 15<br />total_fare:   200.00<br />type: green","pickup_hr: 16<br />total_fare:   193.41<br />type: green","pickup_hr: 17<br />total_fare:   323.73<br />type: green","pickup_hr: 18<br />total_fare:   231.13<br />type: green","pickup_hr: 19<br />total_fare:   122.50<br />type: green","pickup_hr: 20<br />total_fare:   204.50<br />type: green","pickup_hr: 21<br />total_fare:   276.47<br />type: green","pickup_hr: 22<br />total_fare:   103.00<br />type: green","pickup_hr: 23<br />total_fare:   173.14<br />type: green"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(68,1,84,1)","dash":"solid"},"hoveron":"points","name":"green","legendgroup":"green","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[90,81,42.5,37.5,27,37,255.28,653.5,965.56,1041.5,814.69,835.51,656,632.56,823,1000.66,1217.38,1145.09,916,720.5,690,459,340.5,210.55],"text":["pickup_hr:  0<br />total_fare:    90.00<br />type: green","pickup_hr:  1<br />total_fare:    81.00<br />type: green","pickup_hr:  2<br />total_fare:    42.50<br />type: green","pickup_hr:  3<br />total_fare:    37.50<br />type: green","pickup_hr:  4<br />total_fare:    27.00<br />type: green","pickup_hr:  5<br />total_fare:    37.00<br />type: green","pickup_hr:  6<br />total_fare:   255.28<br />type: green","pickup_hr:  7<br />total_fare:   653.50<br />type: green","pickup_hr:  8<br />total_fare:   965.56<br />type: green","pickup_hr:  9<br />total_fare:  1041.50<br />type: green","pickup_hr: 10<br />total_fare:   814.69<br />type: green","pickup_hr: 11<br />total_fare:   835.51<br />type: green","pickup_hr: 12<br />total_fare:   656.00<br />type: green","pickup_hr: 13<br />total_fare:   632.56<br />type: green","pickup_hr: 14<br />total_fare:   823.00<br />type: green","pickup_hr: 15<br />total_fare:  1000.66<br />type: green","pickup_hr: 16<br />total_fare:  1217.38<br />type: green","pickup_hr: 17<br />total_fare:  1145.09<br />type: green","pickup_hr: 18<br />total_fare:   916.00<br />type: green","pickup_hr: 19<br />total_fare:   720.50<br />type: green","pickup_hr: 20<br />total_fare:   690.00<br />type: green","pickup_hr: 21<br />total_fare:   459.00<br />type: green","pickup_hr: 22<br />total_fare:   340.50<br />type: green","pickup_hr: 23<br />total_fare:   210.55<br />type: green"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(68,1,84,1)","dash":"solid"},"hoveron":"points","name":"green","legendgroup":"green","showlegend":false,"xaxis":"x","yaxis":"y3","hoverinfo":"text","frame":null},{"x":[0,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[31,17.5,44.96,92.24,192.3,299.5,181.61,156.41,69,157.16,168.44,88.51,170.5,30,130.66,44,260.37,24,18,68.49,48,16.5],"text":["pickup_hr:  0<br />total_fare:    31.00<br />type: green","pickup_hr:  3<br />total_fare:    17.50<br />type: green","pickup_hr:  4<br />total_fare:    44.96<br />type: green","pickup_hr:  5<br />total_fare:    92.24<br />type: green","pickup_hr:  6<br />total_fare:   192.30<br />type: green","pickup_hr:  7<br />total_fare:   299.50<br />type: green","pickup_hr:  8<br />total_fare:   181.61<br />type: green","pickup_hr:  9<br />total_fare:   156.41<br />type: green","pickup_hr: 10<br />total_fare:    69.00<br />type: green","pickup_hr: 11<br />total_fare:   157.16<br />type: green","pickup_hr: 12<br />total_fare:   168.44<br />type: green","pickup_hr: 13<br />total_fare:    88.51<br />type: green","pickup_hr: 14<br />total_fare:   170.50<br />type: green","pickup_hr: 15<br />total_fare:    30.00<br />type: green","pickup_hr: 16<br />total_fare:   130.66<br />type: green","pickup_hr: 17<br />total_fare:    44.00<br />type: green","pickup_hr: 18<br />total_fare:   260.37<br />type: green","pickup_hr: 19<br />total_fare:    24.00<br />type: green","pickup_hr: 20<br />total_fare:    18.00<br />type: green","pickup_hr: 21<br />total_fare:    68.49<br />type: green","pickup_hr: 22<br />total_fare:    48.00<br />type: green","pickup_hr: 23<br />total_fare:    16.50<br />type: green"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(68,1,84,1)","dash":"solid"},"hoveron":"points","name":"green","legendgroup":"green","showlegend":false,"xaxis":"x","yaxis":"y4","hoverinfo":"text","frame":null},{"x":[5,6,7,8,9,10,11,13,14,15,17,18,19],"y":[62.54,179,32.97,16,35,72.79,32,29.5,44,7.5,22.44,15,82.04],"text":["pickup_hr:  5<br />total_fare:    62.54<br />type: yellow","pickup_hr:  6<br />total_fare:   179.00<br />type: yellow","pickup_hr:  7<br />total_fare:    32.97<br />type: yellow","pickup_hr:  8<br />total_fare:    16.00<br />type: yellow","pickup_hr:  9<br />total_fare:    35.00<br />type: yellow","pickup_hr: 10<br />total_fare:    72.79<br />type: yellow","pickup_hr: 11<br />total_fare:    32.00<br />type: yellow","pickup_hr: 13<br />total_fare:    29.50<br />type: yellow","pickup_hr: 14<br />total_fare:    44.00<br />type: yellow","pickup_hr: 15<br />total_fare:     7.50<br />type: yellow","pickup_hr: 17<br />total_fare:    22.44<br />type: yellow","pickup_hr: 18<br />total_fare:    15.00<br />type: yellow","pickup_hr: 19<br />total_fare:    82.04<br />type: yellow"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(253,231,37,1)","dash":"solid"},"hoveron":"points","name":"yellow","legendgroup":"yellow","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[36,14,20.5,7,194.99,285.48,182,184.5,86,95,72,89.36,121,101.06,128,80,196.23,89.5,82,102,74.5,88],"text":["pickup_hr:  0<br />total_fare:    36.00<br />type: yellow","pickup_hr:  2<br />total_fare:    14.00<br />type: yellow","pickup_hr:  3<br />total_fare:    20.50<br />type: yellow","pickup_hr:  5<br />total_fare:     7.00<br />type: yellow","pickup_hr:  6<br />total_fare:   194.99<br />type: yellow","pickup_hr:  7<br />total_fare:   285.48<br />type: yellow","pickup_hr:  8<br />total_fare:   182.00<br />type: yellow","pickup_hr:  9<br />total_fare:   184.50<br />type: yellow","pickup_hr: 10<br />total_fare:    86.00<br />type: yellow","pickup_hr: 11<br />total_fare:    95.00<br />type: yellow","pickup_hr: 12<br />total_fare:    72.00<br />type: yellow","pickup_hr: 13<br />total_fare:    89.36<br />type: yellow","pickup_hr: 14<br />total_fare:   121.00<br />type: yellow","pickup_hr: 15<br />total_fare:   101.06<br />type: yellow","pickup_hr: 16<br />total_fare:   128.00<br />type: yellow","pickup_hr: 17<br />total_fare:    80.00<br />type: yellow","pickup_hr: 18<br />total_fare:   196.23<br />type: yellow","pickup_hr: 19<br />total_fare:    89.50<br />type: yellow","pickup_hr: 20<br />total_fare:    82.00<br />type: yellow","pickup_hr: 21<br />total_fare:   102.00<br />type: yellow","pickup_hr: 22<br />total_fare:    74.50<br />type: yellow","pickup_hr: 23<br />total_fare:    88.00<br />type: yellow"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(253,231,37,1)","dash":"solid"},"hoveron":"points","name":"yellow","legendgroup":"yellow","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[4053,2244,1101,855,768.5,1349.5,4907,10042,12806.46,12788.6,10953,11127.19,11709.8,11582.42,12074.5,12597.05,11763.84,14248.58,16074.39,15758.39,13918.48,12328,12538.28,9713.99],"text":["pickup_hr:  0<br />total_fare:  4053.00<br />type: yellow","pickup_hr:  1<br />total_fare:  2244.00<br />type: yellow","pickup_hr:  2<br />total_fare:  1101.00<br />type: yellow","pickup_hr:  3<br />total_fare:   855.00<br />type: yellow","pickup_hr:  4<br />total_fare:   768.50<br />type: yellow","pickup_hr:  5<br />total_fare:  1349.50<br />type: yellow","pickup_hr:  6<br />total_fare:  4907.00<br />type: yellow","pickup_hr:  7<br />total_fare: 10042.00<br />type: yellow","pickup_hr:  8<br />total_fare: 12806.46<br />type: yellow","pickup_hr:  9<br />total_fare: 12788.60<br />type: yellow","pickup_hr: 10<br />total_fare: 10953.00<br />type: yellow","pickup_hr: 11<br />total_fare: 11127.19<br />type: yellow","pickup_hr: 12<br />total_fare: 11709.80<br />type: yellow","pickup_hr: 13<br />total_fare: 11582.42<br />type: yellow","pickup_hr: 14<br />total_fare: 12074.50<br />type: yellow","pickup_hr: 15<br />total_fare: 12597.05<br />type: yellow","pickup_hr: 16<br />total_fare: 11763.84<br />type: yellow","pickup_hr: 17<br />total_fare: 14248.58<br />type: yellow","pickup_hr: 18<br />total_fare: 16074.39<br />type: yellow","pickup_hr: 19<br />total_fare: 15758.39<br />type: yellow","pickup_hr: 20<br />total_fare: 13918.48<br />type: yellow","pickup_hr: 21<br />total_fare: 12328.00<br />type: yellow","pickup_hr: 22<br />total_fare: 12538.28<br />type: yellow","pickup_hr: 23<br />total_fare:  9713.99<br />type: yellow"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(253,231,37,1)","dash":"solid"},"hoveron":"points","name":"yellow","legendgroup":"yellow","showlegend":false,"xaxis":"x","yaxis":"y3","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[603,572,104,11,66.08,430.5,882.65,1324.5,1365,2245.5,1604.85,1527.5,1589.42,1325.5,3010.5,1736.5,2988,2806,2638.5,3057.5,2112.5,2101.5,1876,1428],"text":["pickup_hr:  0<br />total_fare:   603.00<br />type: yellow","pickup_hr:  1<br />total_fare:   572.00<br />type: yellow","pickup_hr:  2<br />total_fare:   104.00<br />type: yellow","pickup_hr:  3<br />total_fare:    11.00<br />type: yellow","pickup_hr:  4<br />total_fare:    66.08<br />type: yellow","pickup_hr:  5<br />total_fare:   430.50<br />type: yellow","pickup_hr:  6<br />total_fare:   882.65<br />type: yellow","pickup_hr:  7<br />total_fare:  1324.50<br />type: yellow","pickup_hr:  8<br />total_fare:  1365.00<br />type: yellow","pickup_hr:  9<br />total_fare:  2245.50<br />type: yellow","pickup_hr: 10<br />total_fare:  1604.85<br />type: yellow","pickup_hr: 11<br />total_fare:  1527.50<br />type: yellow","pickup_hr: 12<br />total_fare:  1589.42<br />type: yellow","pickup_hr: 13<br />total_fare:  1325.50<br />type: yellow","pickup_hr: 14<br />total_fare:  3010.50<br />type: yellow","pickup_hr: 15<br />total_fare:  1736.50<br />type: yellow","pickup_hr: 16<br />total_fare:  2988.00<br />type: yellow","pickup_hr: 17<br />total_fare:  2806.00<br />type: yellow","pickup_hr: 18<br />total_fare:  2638.50<br />type: yellow","pickup_hr: 19<br />total_fare:  3057.50<br />type: yellow","pickup_hr: 20<br />total_fare:  2112.50<br />type: yellow","pickup_hr: 21<br />total_fare:  2101.50<br />type: yellow","pickup_hr: 22<br />total_fare:  1876.00<br />type: yellow","pickup_hr: 23<br />total_fare:  1428.00<br />type: yellow"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(253,231,37,1)","dash":"solid"},"hoveron":"points","name":"yellow","legendgroup":"yellow","showlegend":false,"xaxis":"x","yaxis":"y4","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":53.8580323785803,"r":18.9954337899543,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"<b> Hourly total fares spent on drop-off locations in Manhattan <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.15,24.15],"tickmode":"array","ticktext":["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"tickvals":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"categoryorder":"array","categoryarray":["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y4","title":"","hoverformat":".2f"},"annotations":[{"text":"Pick-up hour","x":0.5,"y":-0.0471841704718417,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis"},{"text":"Total fare ($)","x":-0.0597956077408132,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis"},{"text":"Bronx","x":1,"y":0.882610350076104,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":90,"xanchor":"left","yanchor":"middle"},{"text":"Brooklyn","x":1,"y":0.625,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":90,"xanchor":"left","yanchor":"middle"},{"text":"Manhattan","x":1,"y":0.375,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":90,"xanchor":"left","yanchor":"middle"},{"text":"Queens","x":1,"y":0.117389649923896,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":90,"xanchor":"left","yanchor":"middle"}],"yaxis":{"domain":[0.765220700152207,1],"automargin":true,"type":"linear","autorange":false,"range":[-796.3695,16877.7595],"tickmode":"array","ticktext":["0","5000","10000","15000"],"tickvals":[0,5000,10000,15000],"categoryorder":"array","categoryarray":["0","5000","10000","15000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.765220700152207,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","y0":0.765220700152207,"y1":1,"x0":0,"x1":23.37899543379,"xanchor":1,"xsizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.515220700152207,"y1":0.734779299847793},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","y0":0.515220700152207,"y1":0.734779299847793,"x0":0,"x1":23.37899543379,"xanchor":1,"xsizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.265220700152207,"y1":0.484779299847793},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","y0":0.265220700152207,"y1":0.484779299847793,"x0":0,"x1":23.37899543379,"xanchor":1,"xsizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":0.234779299847793},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","y0":0,"y1":0.234779299847793,"x0":0,"x1":23.37899543379,"xanchor":1,"xsizemode":"pixel"}],"yaxis2":{"type":"linear","autorange":false,"range":[-796.3695,16877.7595],"tickmode":"array","ticktext":["0","5000","10000","15000"],"tickvals":[0,5000,10000,15000],"categoryorder":"array","categoryarray":["0","5000","10000","15000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.515220700152207,0.734779299847793],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"yaxis3":{"type":"linear","autorange":false,"range":[-796.3695,16877.7595],"tickmode":"array","ticktext":["0","5000","10000","15000"],"tickvals":[0,5000,10000,15000],"categoryorder":"array","categoryarray":["0","5000","10000","15000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.265220700152207,0.484779299847793],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"yaxis4":{"type":"linear","autorange":false,"range":[-796.3695,16877.7595],"tickmode":"array","ticktext":["0","5000","10000","15000"],"tickvals":[0,5000,10000,15000],"categoryorder":"array","categoryarray":["0","5000","10000","15000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0,0.234779299847793],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":1},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"e7443807d51":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"e7443807d51","visdat":{"e7443807d51":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script> We can see that the highest total fares can be observed during morning rush hours (6-9am), evening rush hours (4pm-6pm), dinner time (6pm-9pm), and tapering off a little at night (after 9pm) on Valentine’s Day. This high amount of aggregate fares show that people either traveled in high volumes to drop-off locations in Manhattan, or took longer trips from other boroughs to Manhattan (longer distance travelled) during these hours. Furthermore, most taxi fares were by yellow taxis, which suggests that these trips took place mostly below East 96th and West 110th Street.</p>
<p>You might also be interested in the neighborhoods in Manhattan with the highest average taxi fares (which means they are popular!) If so, you can check it out in the Shiny app!</p>
<pre class="r"><code>#make the data that we will use from now on, filtering out &quot;for hire&quot; vehicles and Staten Island pick-up boro (since there&#39;s insignficant amount of pick=ups)
fare_data = 
transport_final %&gt;% 
   filter(type != &quot;for hire&quot;,
         pu_boro != &quot;Staten Island&quot;) %&gt;% 
  drop_na(pu_boro)</code></pre>
<p>We also break the hours down and recoded them into factors; e.g., 6am-9am is “morning rush”, 4pm-6pm is “evening rush”, 6pm-9pm is “dinner time”, etc.</p>
<pre class="r"><code>#recode hours
fare_data =
  fare_data %&gt;% 
  mutate(time_of_day=
              cut(pickup_hr, 
                  breaks = c(0,2,5,9,11,13,16,18,21,23),
                  labels = c(&quot;night&quot;,&quot;early morning&quot;,&quot;morning rush&quot;,&quot;others&quot;,&quot;lunch&quot;,&quot;others&quot;,&quot;evening rush&quot;,&quot;dinner time&quot;,&quot;night&quot;)),
         congestion = (fare_amount - trip_distance*2.5 -2.5)/.5)%&gt;% 
  filter(congestion&gt;=0) %&gt;% 
  drop_na(fare_amount)</code></pre>
<p>We might want to look at the distribution of the outcome variable fare amount.</p>
<pre class="r"><code>fare_data %&gt;% 
  drop_na(fare_amount) %&gt;% 
  ggplot(aes(x = fare_amount)) + 
  geom_density()</code></pre>
<p><img src="fare_analysis_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Since the data looks heavily right skewed, we decided to drop fares that are above $60</p>
<pre class="r"><code>fare_data = 
  fare_data %&gt;% filter(fare_amount &lt;= 60)</code></pre>
<p>It might be a good idea to look at the correlation plot between fare and other continuous variables.</p>
<pre class="r"><code>fare_data %&gt;%
  select(fare_amount, trip_distance, duration, extra, tolls_amount) %&gt;% 
Filter(is.numeric,.) %&gt;%              #filter only numeric variables 
  cor() %&gt;%                           #compute correlation matrix
  corrplot(method = &quot;circle&quot;,         #represent correlation in &quot;circle&quot;, size = magnitude 
           type = &quot;upper&quot;, 
           diag=FALSE)</code></pre>
<p><img src="fare_analysis_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Qualitatively, the variables that might be reasonably associated with fare amount include: trip duration, trip distance, time of day, tolls amount, taxi type, pick-up borough, and extra fees. So a regression model with the abovementioned as predictors can be our original expanded model.</p>
<p>Looking at the correlation plot, we saw that outcome variable fare is highly correlated with trip distance and tolls amount, well as duration, so we included these as predictors for our second model. Qualitatively, we might also add time of day to this model.</p>
<p>We also used stepwise regression with AIC as the criterion to potentially get a more parsimonious model.</p>
<p>Stepwise regression did not suggest leaving any variables out of the model (stick with the original expanded model). However, we wanted to see if a very parsimonious models (only with trip distance and duration as predictors) would perform better.</p>
<p>Next, we fitted the expanded model, as stepwise regression suggested.</p>
<p>Model diagnostics suggest that observation 123 and 16214 are highly influential points (based on crossing Cook’s distance cut-off value), so we removed it.</p>
<pre class="r"><code>fare_data = fare_data[-c(123, 16214),]</code></pre>
<p>We refitted the model and below is the regression summary output for this first model (stepwise)</p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">3.8682173</td>
<td align="right">0.3042885</td>
<td align="right">12.712333</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">trip_distance</td>
<td align="right">2.9119349</td>
<td align="right">0.0105437</td>
<td align="right">276.178770</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">duration</td>
<td align="right">0.0026268</td>
<td align="right">0.0002564</td>
<td align="right">10.245506</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">as.factor(time_of_day)early morning</td>
<td align="right">-1.0209591</td>
<td align="right">0.1565986</td>
<td align="right">-6.519593</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">as.factor(time_of_day)morning rush</td>
<td align="right">0.8990284</td>
<td align="right">0.0652982</td>
<td align="right">13.768039</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">as.factor(time_of_day)others</td>
<td align="right">1.6312348</td>
<td align="right">0.0613797</td>
<td align="right">26.576121</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">as.factor(time_of_day)lunch</td>
<td align="right">1.6365450</td>
<td align="right">0.0755214</td>
<td align="right">21.669943</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">as.factor(time_of_day)evening rush</td>
<td align="right">1.3085435</td>
<td align="right">0.0704305</td>
<td align="right">18.579205</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">as.factor(time_of_day)dinner time</td>
<td align="right">0.4879576</td>
<td align="right">0.0648260</td>
<td align="right">7.527185</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">extra</td>
<td align="right">0.0418769</td>
<td align="right">0.0143375</td>
<td align="right">2.920790</td>
<td align="right">0.0034946</td>
</tr>
<tr class="odd">
<td align="left">tolls_amount</td>
<td align="right">0.3183774</td>
<td align="right">0.0346650</td>
<td align="right">9.184407</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">as.factor(type)yellow</td>
<td align="right">0.1629665</td>
<td align="right">0.0763161</td>
<td align="right">2.135414</td>
<td align="right">0.0327369</td>
</tr>
<tr class="odd">
<td align="left">as.factor(pu_boro)Brooklyn</td>
<td align="right">0.8849376</td>
<td align="right">0.3345510</td>
<td align="right">2.645150</td>
<td align="right">0.0081706</td>
</tr>
<tr class="even">
<td align="left">as.factor(pu_boro)Manhattan</td>
<td align="right">-0.4005851</td>
<td align="right">0.2996185</td>
<td align="right">-1.336984</td>
<td align="right">0.1812401</td>
</tr>
<tr class="odd">
<td align="left">as.factor(pu_boro)Queens</td>
<td align="right">-2.6404509</td>
<td align="right">0.3276313</td>
<td align="right">-8.059215</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="right">r.squared</th>
<th align="right">adj.r.squared</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8806385</td>
<td align="right">0.8805719</td>
</tr>
</tbody>
</table>
<p>Fitting second and third model, and below are the regression outputs:</p>
<pre class="r"><code>pars_lm = lm(fare_amount ~ trip_distance + duration, data = fare_data)

pars_lm %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable()

pars_lm %&gt;% 
  broom::glance() %&gt;% 
  .[,1:2] %&gt;% 
  knitr::kable()</code></pre>
<pre class="r"><code>moderate_lm = lm(fare_amount ~ trip_distance + duration + as.factor(time_of_day), data = fare_data)

moderate_lm %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">3.7238751</td>
<td align="right">0.0532813</td>
<td align="right">69.890791</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trip_distance</td>
<td align="right">2.8929704</td>
<td align="right">0.0068463</td>
<td align="right">422.557574</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">duration</td>
<td align="right">0.0026143</td>
<td align="right">0.0002574</td>
<td align="right">10.157811</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">as.factor(time_of_day)early morning</td>
<td align="right">-1.0637538</td>
<td align="right">0.1572106</td>
<td align="right">-6.766423</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">as.factor(time_of_day)morning rush</td>
<td align="right">0.8854679</td>
<td align="right">0.0649975</td>
<td align="right">13.623108</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">as.factor(time_of_day)others</td>
<td align="right">1.6077789</td>
<td align="right">0.0613516</td>
<td align="right">26.205989</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">as.factor(time_of_day)lunch</td>
<td align="right">1.6093708</td>
<td align="right">0.0754804</td>
<td align="right">21.321715</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">as.factor(time_of_day)evening rush</td>
<td align="right">1.3058245</td>
<td align="right">0.0701641</td>
<td align="right">18.611016</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">as.factor(time_of_day)dinner time</td>
<td align="right">0.4812669</td>
<td align="right">0.0649983</td>
<td align="right">7.404304</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>moderate_lm %&gt;% 
  broom::glance() %&gt;% 
  .[,1:2] %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">r.squared</th>
<th align="right">adj.r.squared</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8795474</td>
<td align="right">0.879509</td>
</tr>
</tbody>
</table>
<p>Make this comparison in terms of the cross-validated prediction error</p>
<pre class="r"><code>cv_df =                          #split into train/test 10 times, and stores using list column
  crossv_mc(fare_data, 100) %&gt;% 
  mutate(                        #transform list into tibbles
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %&gt;%  #&quot;map&quot; model fitting to each train dataset for all 3 models
  mutate(stepwise = map(train, ~lm(fare_amount ~ trip_distance + duration + as.factor(time_of_day) + extra + tolls_amount + as.factor(type) + as.factor(pu_boro) + as.factor(vendor_id), data = .x)),
         parsimonious = map(train, ~lm(fare_amount ~ trip_distance + duration, data = .x)),
         moderate  = map(train, ~lm(fare_amount ~ trip_distance + duration + as.factor(time_of_day), data = .x))) %&gt;% 
#&quot;map&quot; rmse using model created by train data and and apply on test data to get rmse
  mutate(rmse_stepwise = map2_dbl(stepwise, test, ~rmse(model = .x, data = .y)),
         rmse_parsimonious = map2_dbl(parsimonious, test, ~rmse(model = .x, data = .y)),
         rmse_moderate = map2_dbl(moderate, test, ~rmse(model = .x, data = .y)))

#plot rmse distribution by each model
cv_df %&gt;% 
  select(starts_with(&quot;rmse&quot;)) %&gt;%   #select rmse column
  pivot_longer(                     #transform to long tibble to easily specify group when plot
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse, fill = model)) + #specify elements going into the plots
  geom_violin(alpha = 0.3) + 
  labs(title = &quot;Violin plot for RMSE across three models&quot;, #annotate and modify plots
       y = &quot;RMSE&quot;) + 
  theme_bw() + 
  theme(legend.position = &quot;none&quot;,
        plot.title =     
          element_text(hjust = 0.5, size=12, face=&#39;bold&#39;))</code></pre>
<p><img src="fare_analysis_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>This plot above suggests although the moderate model performs only marginal better than the stepwise and parsimonious model, it seems to be the best choice given a balance of both parsimony and better predictive ability.</p>
<p>Model diagnostics</p>
<pre class="r"><code>par(mfrow=c(2,2))
plot(moderate_lm)</code></pre>
<p><img src="fare_analysis_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Check for multicollinearity</p>
<pre class="r"><code>car::vif(moderate_lm)</code></pre>
<pre><code>##                            GVIF Df GVIF^(1/(2*Df))
## trip_distance          1.019672  1        1.009788
## duration               1.017733  1        1.008828
## as.factor(time_of_day) 1.003564  6        1.000296</code></pre>
<p>Since VIF for all predictors are below 5, we don’t need to worry about multicollinearity.</p>
<div id="imputation-of-fare" class="section level3">
<h3>Imputation of fare</h3>
<p>The fare estimator used a subset of the original dataset with average fare amount computed for each combination of pick-up and drop-off neighborhood. However, there are instances where fare amount is only available for the pick-up and drop-offs neighborhoods there were a total of 228 trips meeting these criteria. The distances and duration of these trips were then imputed based on the fare amount, rate code, and the median speed of trips with valid distance and duration data.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
