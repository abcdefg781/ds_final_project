---
title: "Heatmaps"
output: html_document
---

```{r setup, include=FALSE}
library(readr)
library(tidyverse)
library(d3heatmap)
knitr::opts_chunk$set(echo = TRUE)
set.seed(1)
```
To further investigate where people go on Valentine's Day via taxi or for hire car services, we made several heat maps to breakdown where people from each borough were coming into Manhattan. Due to the lack of drop-offs in Manhattan from Staten Island, we do not include Staten Island rides in any of the heat maps. 

If you are interested in looking at the general heat map trends, click [here](overview.html)!

## How to Read The Heat Maps 

The zones represented by the rows are the drop off locations in Manhattan, and the zones represented by the columns are the pick up locations in the respective borough. Both are arranged alphabetically for ease of finding specific pick-up to drop-off locations. 

To see how many trips occurred between the desired locations, hover over the grid with the mouse. To zoom in on a specific area of any heat map, drag the mouse over the desired area. To highlight a specific pick-up or drop-off location, click on the desired location name.  

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
transport_final = read.csv("./data/transport_final.csv")

dinner_time_transport <- transport_final %>% 
  filter(stringr::str_detect(pickup_time, '^18|^19|^20'))

late_night_transport <- transport_final %>% 
  filter(
    stringr::str_detect(pickup_time, '^21|^22|^23')|
    pickup_date == "2019-02-15"
    )
```


```{r heatmap codes,echo=FALSE,warning=FALSE,message=FALSE}
manhattan_matrix <- function(input_boro, input_df) {
  man_man_df <- input_df %>% 
  filter(
    pu_boro == input_boro
  ) %>% 
  select(
    pu_neiborhood, do_neiborhood
  ) %>% 
  group_by(pu_neiborhood, do_neiborhood) %>% 
  summarise(count = n()) %>% 
  pivot_wider(
    names_from = pu_neiborhood,
    values_from = count
  ) %>% 
  replace(is.na(.),0) %>% 
  arrange(do_neiborhood) 

man_man_matrix <- as.matrix(man_man_df[-1])
row.names(man_man_matrix) <- pull(man_man_df, do_neiborhood)  
return(man_man_matrix)
}

heatmap_function <- function(input_matrix) {
  into_man_heatmap <- d3heatmap(input_matrix, scale = "none", colors = "RdPu",  dendrogram = "none", Rowv = FALSE, Colv = FALSE) 
  return(into_man_heatmap)
}
```

# All of Valentine's Day

The first set of heat maps looks at all the rides on Valentine's Day, including midnight to 2 AM on February 15th to account for post dinner plans. 

## Manhattan to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan ranged from 0 to 218 rides. 

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
man_man_matrix <- manhattan_matrix("Manhattan", transport_final)

heatmap_function(man_man_matrix)
```

The Upper East Side loves itself, as many of the rides originate and end in either the Upper East Side North or South. Central Harlem and Central Harlem North, along with East Harlem North and East Harlem South also practice this form of self-love. 

Pick-ups and drop-offs in Midtown Center, East, North, and South, Murray Hill, and Penn Station are popular among most of the Manhattan locations. 

## Brooklyn to Manhattan

The number of rides from any single pick-up location in Brooklyn to any single drop-off location in Manhattan ranged from 0 to 19 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
brooklyn_man_matrix <- manhattan_matrix("Brooklyn", transport_final)

heatmap_function(brooklyn_man_matrix)
```


## Queens to Manhattan

The number of rides from any single pick-up location in Queens to any single drop-off location in Manhattan ranged from 0 to 80 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
queens_man_matrix <- manhattan_matrix("Queens", transport_final)

heatmap_function(queens_man_matrix)
```

Unsurprisingly, the most active pick-up locations in Queens on Valentine's Day are LaGuardia Airport and JFK Airport. Although this could be a coincidence, we would like to think that people are flying into New York to spend a special Valentine's Day with their special someone. 

For both airports, the most popular drop-off location is Times Square/Theater District, with Midtown Center, East, North, and South, Clinton East, and Murray Hill also as popular drop-off spots. 

## Bronx to Manhattan

The number of rides from any single pick-up location in the Bronx to any single drop-off location in Manhattan ranged from 0 to 19 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
bronx_man_matrix <- manhattan_matrix("Bronx", transport_final) 

heatmap_function(bronx_man_matrix)
```

People from the Bronx that ventured to Manhattan tended to stay within Northern Manhattan, as Central Harlem North, East Harlem North, Inwood, and Washington Heights North and South received the most drop-off traffic. 

# Dinner time on Valentine's Day

Especially since Valentine's Day in 2019 was on a Thursday, most Valentine's Day plans would be scheduled after work. Since many restaurants and businesses have Valentine's Day events or specials, we decided to look at Manhattan drop offs from 6 PM to 9 PM. 

The following heat maps only encompass the dinner time period, allocated between 6 PM to 9 PM. 

## Manhattan to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 6 PM to 9 PM ranged from 0 to 41 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
man_man_dinner <- manhattan_matrix("Manhattan", dinner_time_transport)

heatmap_function(man_man_dinner)
```


## Brooklyn to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 6 PM to 9 PM ranged from 0 to 4 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
brooklyn_man_dinner <- manhattan_matrix("Brooklyn", dinner_time_transport)

heatmap_function(brooklyn_man_dinner)
```

## Queens to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 6 PM to 9 PM ranged from 0 to 13 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
queens_man_dinner <- manhattan_matrix("Queens", dinner_time_transport)

heatmap_function(queens_man_dinner)
```

## Bronx to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 6 PM to 9 PM ranged from 0 to 6 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
bronx_man_dinner <- manhattan_matrix("Bronx", dinner_time_transport) 

heatmap_function(bronx_man_dinner)
```

# Post Dinner on Valentine's Day  

The following heat maps encompass only the later night hours from 9 PM of Valentine's Day to 2 AM of February 15th. 

## Manhattan to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 9 PM on Valentine's Day to 2 AM on February 15th ranged from 0 to 36 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
man_man_late <- manhattan_matrix("Manhattan", late_night_transport)

heatmap_function(man_man_late)
```


## Brooklyn to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 9 PM on Valentine's Day to 2 AM on February 15th ranged from 0 to 9 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
brooklyn_man_late <- manhattan_matrix("Brooklyn", late_night_transport)

heatmap_function(brooklyn_man_late)
```

## Queens to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 9 PM on Valentine's Day to 2 AM on February 15th ranged from 0 to 11 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
queens_man_late <- manhattan_matrix("Queens", late_night_transport)

heatmap_function(queens_man_late)
```

## Bronx to Manhattan

The number of rides from any single pick-up location in Manhattan to any single drop-off location in Manhattan from 9 PM on Valentine's Day to 2 AM on February 15th ranged from 0 to 5 rides.

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
bronx_man_late <- manhattan_matrix("Bronx", late_night_transport) 

heatmap_function(bronx_man_late)
```


