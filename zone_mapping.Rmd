---
title: "Taxi Zones"
author: "Adeline Shin"
date: "11/22/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages("sf")
# install.packages("tmap")

library(tidyverse)
library(leaflet)
library(viridis)
library(sf)
library(tmap)
library(plotly)
```

# Loading in Taxi Zone Codes
```{r}
taxi_zones = read.csv("./data/taxi_zones.csv")

taxi_zones %>% 
  ggplot(aes(x = x, y = y)) +
  geom_point()
```

# Mapping Lat/Long
```{r}
pal = colorFactor(
  palette = magma,
  domain = taxi_zones$borough
)

taxi_zones %>% 
  leaflet() %>% 
  addTiles() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addCircleMarkers(
    ~x, ~y,
    color = ~pal(borough),
    radius = 1
  ) %>% 
  
```

# Mapping Zones
```{r}
zone_map_data = read_sf("./data/taxi_zones.shp")

write_csv(zone_map_data, "zone_map_data.csv")

tmap_mode("plot")

zone_map =
  tm_shape(zone_map_data) +
  tm_fill(col = "borough") +
  tm_polygons("LocationID")

zone_map + tm_basemap(server = "OpenTopoMap")

```

```{r}
library(rgdal)
zone_coords =
  zone_map_data[[7]]

coords = 
  as.data.frame(zone_coords[[1]][[1]][[1]]) %>% 
  select(lon = V1, lat = V2)

coords = SpatialPoints (coords, proj4string = CRS ('+proj=utm +zone=18 +ellps=GRS80 +datum=NAD83 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs'))

coord_WGS84 <- spTransform(coords, CRS('+proj=longlat +datum=WGS84 +no_defs'))

coordinates(coords) = c("lon", "lat")
proj4string(coords) = CRS("+init=epsg:4326")
```

```{r}
zone_map_data %>% 
  leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) 
```

